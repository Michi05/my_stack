<launch>

  <!-- ================================================ -->
  <!-- Which robots to create                           -->
  <!-- ================================================ -->
  <arg name="create_pioneer3dx" default="true" />
  <arg name="create_erratic"    default="false" />
  <arg name="create_pioneer2dx" default="false" />
  <arg name="create_pr2"        default="false" />


  <!-- ================================================ -->
  <!-- Create the world                                 -->
  <!-- ================================================ -->
  <include file="$(find my_gazebo_worlds)/launch/gazebo_world_ecsc.launch" />


  <!-- ================================================ -->
  <!-- Create a pioneer3dx robot in it's own namespace   -->
  <!-- ================================================ -->
  <arg name="pioneer3dx_1_namespace" value="pioneer3dx_1_namespace" />
  <group ns="$(arg pioneer3dx_1_namespace)" if="$(arg create_pioneer3dx)" >

    <!-- Create a globally unique name for the gazebo robot model -->
    <arg name="model_name"        value="pioneer3dx_1_model_name" />

    <!-- Create a name for the base driver node -->
    <arg name="base_driver_node"  value="pioneer3dx_1_base_driver_node" />

    <!-- Create a name for the teleop source node -->
    <arg name="teleop_source_node"  value="pioneer3dx_1_teleop_source_node" />

    <!-- Create a name for the base teleop topic -->
    <arg name="teleop_topic"  value="pioneer3dx_1_teleop_topic" />

    <!-- Create a name for the base twist topic -->
    <arg name="twist_topic"  value="pioneer3dx_1_twist_topic" />

    <!-- Create the simulated robot -->
    <include file="$(find my_gazebo_robots)/launch/gazebo_robot_pioneer3dx.launch" >
      <arg name="model_name"      value="$(arg model_name)" />
      <arg name="x"               value="1" />
      <arg name="y"               value="1" />
    </include>

    <!-- Start the driver for the robot base -->
    <node
      name="$(arg base_driver_node)"
      pkg="my_gazebo_drivers"
      type="gazebo_ros_diffdrive"
      respawn="false"
      output="screen"
      >
      <param name="model_name"      value="$(arg model_name)"  />
      <param name="command_topic"   value="$(arg twist_topic)" />
    </node>

    <!-- Start a teleop source -->
    <node
      name="$(arg teleop_source_node)"
      pkg="teleop_ros"
      type="teleop_source_ros"
      respawn="false"
      output="screen"
      >
      <param name="teleop_type"  value="joystick"            />
      <param name="teleop_topic" value="$(arg teleop_topic)" />
    </node>

    <!-- Start a teleop sink which writes to the base driver -->
    <node
      name="teleop_source_sink_twist_node"
      pkg="teleop_ros"
      type="teleop_sink_twist_ros"
      respawn="false"
      output="screen"
      >
      <param
        name="teleop_topic"
        value="/$(arg pioneer3dx_1_namespace)/$(arg teleop_source_node)/$(arg teleop_topic)"
      />
      <param
        name="twist_topic"
        value="/$(arg pioneer3dx_1_namespace)/$(arg base_driver_node)/$(arg twist_topic)"
      />
      <param name="has_lin_x" value="1" />
      <param name="has_rot_z" value="1" />
      <param name="max_lin_x" value="0.3" />
      <param name="min_lin_x" value="-0.3" />
      <param name="max_rot_z" value="1.57" />
      <param name="min_rot_z" value="-1.57" />
    </node>

  </group>


  <!-- ================================================ -->
  <!-- Create an erratic robot in it's own namespace     -->
  <!-- ================================================ -->
  <group ns="erratic_1_namespace" if="$(arg create_erratic)" >

    <!-- Create a unique name for the gazebo robot model -->
    <arg name="model_name" value="erratic_1_name" />

    <!-- Create the robot -->
    <include file="$(find my_gazebo_robots)/launch/gazebo_robot_erratic.launch" >
      <arg name="model_name"  value="$(arg model_name)" />
      <arg name="x"           value="2"                 />
      <arg name="y"           value="2"                 />
    </include>

  </group>


  <!-- ================================================ -->
  <!-- Create a pioneer2dx robot in it's own namespace   -->
  <!-- ================================================ -->
  <group ns="pioneer2dx_1_namespace" if="$(arg create_pioneer2dx)" >

    <!-- Create a unique name for the gazebo robot model -->
    <arg name="model_name" value="pioneer2dx_1_name" />

    <!-- Create the robot -->
    <include file="$(find my_gazebo_robots)/launch/gazebo_robot_pioneer2dx.launch" >
      <arg name="model_name"  value="$(arg model_name)" />
      <arg name="x"           value="3"                 />
      <arg name="y"           value="7"                 />
    </include>

  </group>


  <!-- ================================================ -->
  <!-- Create a pr2 robot in it's own namespace          -->
  <!-- ================================================ -->
  <group ns="pr2_1_namespace" if="$(arg create_pr2)" >

    <!-- Create a unique name for the gazebo robot model -->
    <arg name="model_name" value="pr2_1_name" />

    <!-- Create the robot -->
    <include file="$(find my_gazebo_robots)/launch/gazebo_robot_pr2.launch" >
      <arg name="model_name"  value="$(arg model_name)" />
      <arg name="x"           value="2"                 />
      <arg name="y"           value="11"                />
    </include>

  </group>

</launch>
